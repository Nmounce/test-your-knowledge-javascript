//code sources: https://www.codingnepalweb.com/quiz-app-with-timer-javascript &
//https://codepen.io/treighton/pen/NWjjJYy &
//https://www.codegrepper.com/code-examples/javascript/javascript+quiz+with+timer
//https://stackoverflow.com/questions/1191865/code-for-a-simple-javascript-countdown-timer
function nextQuestion() {
    var randoQ = questions[Math.floor(Math.random() * questions.length)]
    var title = document.querySelector('#ques')
    var choices = document.querySelector('.choices ul')

    title.textContent = randoQ.title
    choices.innerHTML = randoQ.choices.map(choices => `<li>${choices}</li>`).join('')
  }
  document.querySelector('#next-btn').addEventListener('click', nextQuestion)
var contBtn = document.querySelector('#continue-btn')
var rulesBox = document.querySelector('#rules-box')
var startPage = document.querySelector('#start-page')
var startBtn = document.querySelector('#start-btn')
var quizBox = document.querySelector('#quiz-box')
var reTry = document.querySelector('#restart-btn')
var quit = document.querySelector('#quit-btn')
var resultBox = document.querySelector('#result-box')

//BUTTONS

// Animates buttons on hover
$('.button').on('mouseenter', function () {
    $(this).addClass('active');
});
$('.button').on('mouseleave', function () {
    $(this).removeClass('active');
});

//Continue button -> nav to Rules page
contBtn.onclick = () => {
    startPage.classList.remove("startInfo"); //remove start page
    rulesBox.classList.add("activeRules"); //show rules box
};

//start timer

var count = 90;
var interval = startTimer(function(){
    document.querySelector('#timer-total').innerHTML=count;
    count--;
    if (count === 0){
        clearInterval(interval),
        document.querySelector('#timer-total').innerHTML="0",
        alert("Time's Up!")
      }1000
};

//Start Quiz button -> nav to quiz page
startBtn.onclick = (start) => {
    rulesBox.classList.remove("activeRules"); //remove rules box
    quizBox.classList.add("activeQuiz"); //show quiz box
    showQuestions(0); //calling showQuestions function
    startTimer(90); //calling startTimer function
};


//QUIZ

//click attribute for user selection
var choice = choices.querySelector('.choice');
var userScore = document.querySelector('#score-total')

for(i=0; i < choice.length; i++){
    choice[i].setAttribute('onClick', 'optionSelected(this)');
}

function userChoice (answer){
    clearInterval(counter); //clear counter
    let userAns = answer.textContent; //getting user selected option
    let correctAns = questions[que_count].answer; //getting correct answer from array
    var allChoices = choices.children.length; //getting all option items
    if(userAns == correctAns){ //if user selected option is equal to array's correct answer
        userScore += 1; //upgrading score value with 1
        answer.classList.add("correct");
        console.log("Correct Answer");
        console.log("Your correct answers = " + userScore);
    }else{
        answer.classList.add("incorrect");
        console.log("Wrong Answer");

        for(i=0; i < allChoices; i++){
            if(choices.children[i].textContent == correctAns){ //if there is an option which is matched to an array answer
                choices.children[i].setAttribute("class", "choice correct") //adding green color to matched option
                console.log("Auto selected correct answer.")
            }
        }
    }
    for(i=0; i < allChoices; i++){
        choices.children[i].classList.add("disabled") //once user select an option then disabled all options
    }
    nextBtn.classList.add("show") //show the next button if user selected any option
};



function showResult(){
    startPage.classList.remove('#startPage') //hide start page
    rulesBox.classList.remove('#rules-box') //hide rules box
    quizBox.classList.remove('#quiz-box') //hide quiz box
    resultBox.classList.add('#result-box') //show result box
    scoreText = resultBox.querySelector('#score')
    timeLeft = resultBox.querySelector('#time-left')

    if (userScore > 3){ // if user scored more than 3
        //creating a new span tag and passing the user score number and total question number
        let scoreTag = 'Wow 🎉, You got '+ userScore + ' out of ' + questions.length +'.';
        scoreText.innerHTML = scoreTag;  //adding new span tag inside score_Text
    }
    else if(userScore > 1){ // if user scored more than 1
        let scoreTag = 'Nice 😎, You got ' + userScore +  'out of '+ questions.length +'.';
        scoreText.innerHTML = scoreTag;
    }
    else{ // if user scored less than 1
        let scoreTag = 'Sorry 😐, You got only ' + userScore + ' out of ' +  questions.length +'.';
        scoreText.innerHTML = scoreTag;
    }
}

//Retry button -> navigate to rules page
var reTry = result_box.querySelector('#restart-btn')
var quit = result_box.querySelector('#quit-btn')

reTry.onclick = () => {
    window.location.reload(rulesBox); //reload the rules page
};

//Quit button -> reload page
quit.onclick = ()=>{
    window.location.reload(); //reload the current window
}
